<%# Help Article Page %>
<% content_for :head do %>
  <meta name="description" content="<%= @article[:excerpt] %>">
<% end %>

<div class="bg-theme-primary min-h-screen">
  <%# Hero Section %>
  <section class="relative py-12 md:py-16 bg-gradient-to-r from-indigo-600 to-indigo-800 text-white">
    <div class="absolute inset-0 overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-r from-indigo-600 to-indigo-800 opacity-90"></div>
      <div class="absolute inset-0 bg-grid-white/[0.05] bg-grid-8"></div>
    </div>

    <div class="relative z-10 container mx-auto px-4 sm:px-6 lg:px-8 max-w-5xl">
      <div class="text-center">
        <div class="breadcrumbs justify-center">
          <a href="<%= help_center_path %>" class="text-indigo-200 hover:text-white transition-colors">Help Center</a>
          <span class="separator">/</span>
          <a href="<%= help_category_path(@category) %>" class="text-indigo-200 hover:text-white transition-colors"><%= @current_category[:title] %></a>
          <span class="separator">/</span>
          <span class="text-white"><%= @article[:title] %></span>
        </div>

        <h1 class="text-3xl md:text-4xl font-bold mb-4"><%= @article[:title] %></h1>
        <p class="text-lg text-indigo-100 max-w-3xl mx-auto">
          <%= @article[:excerpt] %>
        </p>
      </div>
    </div>
  </section>

  <%# Main Content %>
  <section class="py-12 md:py-16">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <%# Sidebar %>
        <div class="md:col-span-1 order-2 md:order-1">
          <div class="help-sidebar">
            <div class="mb-8">
              <h3 class="text-xl font-bold mb-4 text-theme-primary">Table of Contents</h3>
              <div class="toc" data-controller="help-toc">
                <%# Table of contents will be generated by JavaScript %>
                <div data-help-toc-target="container"></div>
              </div>
            </div>

            <div class="mb-8">
              <h3 class="text-xl font-bold mb-4 text-theme-primary"><%= @current_category[:title] %></h3>
              <nav>
                <ul class="space-y-2">
                  <% @current_category[:articles].each do |article| %>
                    <li>
                      <a
                        href="<%= help_article_path(@category, article[:slug]) %>"
                        class="block px-3 py-2 rounded-lg <%= article[:slug] == @article_slug ? 'bg-indigo-50 text-indigo-700 font-medium' : 'text-theme-secondary hover:bg-theme-secondary' %> transition-colors text-sm"
                      >
                        <%= article[:title] %>
                      </a>
                    </li>
                  <% end %>
                </ul>
              </nav>
            </div>

            <div class="bg-theme-secondary rounded-lg p-6">
              <h4 class="text-lg font-medium mb-3 text-theme-primary">Need More Help?</h4>
              <p class="text-theme-secondary mb-4">Can't find what you're looking for? Our support team is ready to assist you.</p>
              <a href="/contact" class="theme-btn theme-btn-primary w-full text-center">Contact Support</a>
            </div>
          </div>
        </div>

        <%# Article Content %>
        <div class="md:col-span-2 order-1 md:order-2">
          <article class="bg-theme-primary rounded-lg shadow-sm border border-theme-tertiary p-6 md:p-8">
            <%# Article Content %>
            <div class="article-content" data-help-toc-target="content">
              <%= markdown(@article[:content]) %>
            </div>

            <%# Tags %>
            <div class="mt-8 pt-6 border-t border-theme-tertiary">
              <div class="flex flex-wrap gap-2">
                <% @article[:tags].each do |tag| %>
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
                    <%= tag %>
                  </span>
                <% end %>
              </div>
            </div>

            <%# Feedback Section %>
            <div class="feedback-section" data-controller="help-feedback">
              <h3 class="text-lg font-medium mb-4 text-theme-primary">Was this article helpful?</h3>
              <div class="flex space-x-4">
                <button class="feedback-button" data-action="click->help-feedback#helpful">
                  <span class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5" />
                    </svg>
                    Yes
                  </span>
                </button>
                <button class="feedback-button" data-action="click->help-feedback#notHelpful">
                  <span class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2" />
                    </svg>
                    No
                  </span>
                </button>
              </div>
              <div class="mt-4 hidden" data-help-feedback-target="thankYou">
                <p class="text-green-600">Thank you for your feedback!</p>
              </div>
              <div class="mt-4 hidden" data-help-feedback-target="feedbackForm">
                <p class="text-theme-secondary mb-2">How can we improve this article?</p>
                <textarea class="theme-input mb-2" rows="3" placeholder="Your suggestions..." data-help-feedback-target="feedbackText"></textarea>
                <button class="theme-btn theme-btn-primary" data-action="click->help-feedback#submitFeedback">Submit Feedback</button>
              </div>
            </div>
          </article>

          <%# Related Articles %>
          <% if @related_articles.any? %>
            <div class="mt-8">
              <h3 class="text-xl font-bold mb-4 text-theme-primary">Related Articles</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <% @related_articles.each do |article| %>
                  <a
                    href="<%= help_article_path(@category, article[:slug]) %>"
                    class="article-card"
                  >
                    <h4 class="text-lg font-medium text-theme-primary hover:text-indigo-600 transition-colors"><%= article[:title] %></h4>
                    <p class="text-theme-secondary text-sm mt-1"><%= article[:excerpt] %></p>
                  </a>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </section>
</div>
